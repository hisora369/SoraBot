import{u as U,k as L,j as e,c as A,i as j,a as _,b as I,W as f}from"./index-DPvthqng.js";import{i as E}from"./chunk-2QAN2V2R-Cxqf4Tfy.js";import{u as W,r as i}from"./react-router-dom-1tQCWL6Q.js";import{n as v}from"./react-hot-toast-DgcDyfs-.js";import{I as T}from"./index-x5CrXQNg.js";import{P as D,H,T as O}from"./pure-Di_fIXqu.js";import{t as N}from"./primitives-D092zWiZ.js";import{l as C}from"./logo-juTWEVZj.js";import"./react-dom-DS08_OVb.js";import"./monaco-editor-DSSspO4w.js";import"./react-icons-BUGkfY7x.js";import"./chunk-CAFRINWI-CcU5yOMx.js";import"./chunk-SLABUSGS-PrywWFvD.js";import"./chunk-M3MASYO7-gFSchx_z.js";import"./chunk-EN4B57RQ-BmCZjlx8.js";import"./useToggle-DXhs-6tG.js";import"./filterDOMProps-CghfNOdR.js";import"./usePress-D7H8h7T0.js";import"./chunk-OPTZHMJX-BjmJaKo7.js";function ne(){const x=new URLSearchParams(window.location.search).get("token"),g=W(),[c,h]=i.useState(x||""),[o,y]=i.useState(!1),[u,P]=i.useState(!0),[,b]=U(L.token,"");function k(t){const r=t.replace(/-/g,"+").replace(/_/g,"/"),a=atob(r),s=new Uint8Array(a.length);for(let n=0;n<a.length;n++)s[n]=a.charCodeAt(n);return s}function l(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}const S=async()=>{var t;try{const r=await f.generatePasskeyAuthenticationOptions(),a=await navigator.credentials.get({publicKey:{challenge:k(r.challenge),allowCredentials:(t=r.allowCredentials)==null?void 0:t.map(m=>({id:k(m.id),type:m.type,transports:m.transports})),userVerification:r.userVerification}});if(!a)throw new Error("Passkey authentication cancelled");const s=a.response,n={id:a.id,rawId:l(new Uint8Array(a.rawId)),response:{authenticatorData:l(new Uint8Array(s.authenticatorData)),clientDataJSON:l(new Uint8Array(s.clientDataJSON)),signature:l(new Uint8Array(s.signature)),userHandle:s.userHandle?l(new Uint8Array(s.userHandle)):null},type:a.type},p=await f.verifyPasskeyAuthentication(n);if(p&&p.Credential)return b(p.Credential),g("/qq_login",{replace:!0}),!0}catch(r){console.log("Passkey login failed or not available:",r)}return!1},d=async()=>{if(!c){v.error("è¯·è¾“å…¥token");return}y(!0);try{const t=await f.loginWithToken(c);t&&(b(t),g("/qq_login",{replace:!0}))}catch(t){v.error(t.message)}finally{y(!1)}},w=t=>{t.key==="Enter"&&!o&&!u&&d()};return i.useEffect(()=>(document.addEventListener("keydown",w),()=>{document.removeEventListener("keydown",w)}),[c,o,u]),i.useEffect(()=>{if(x){d();return}S().finally(()=>{P(!1)})},[]),e.jsxs(e.Fragment,{children:[e.jsx("title",{children:"WebUIç™»å½• - NapCat WebUI"}),e.jsx(D,{children:e.jsx("div",{className:"w-[608px] max-w-full py-8 px-2 md:px-8 overflow-hidden",children:e.jsxs(H,{className:"items-center gap-4 pt-0 pb-6 bg-default-50",maxXRotation:3,maxYRotation:3,children:[e.jsxs(A,{className:"inline-block max-w-lg text-center justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center w-full gap-2 pt-10",children:[e.jsx(j,{alt:"logo",height:"7em",src:C}),e.jsxs("div",{children:[e.jsx("span",{className:N(),children:"WebÂ "}),e.jsx("span",{className:N({color:"violet"}),children:"LoginÂ "})]})]}),e.jsx(O,{className:"absolute right-4 top-4"})]}),e.jsxs(_,{className:"flex gap-5 py-5 px-5 md:px-10",children:[u&&e.jsx("div",{className:"text-center text-small text-default-600 dark:text-default-400 px-2",children:"ğŸ” æ­£åœ¨æ£€æŸ¥Passkey..."}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),d()},children:[e.jsx("input",{type:"text",name:"username",value:"napcat-webui",autoComplete:"username",className:"absolute -left-[9999px] opacity-0 pointer-events-none",readOnly:!0,tabIndex:-1,"aria-label":"Username"}),e.jsx(E,{isClearable:!0,type:"password",name:"password",autoComplete:"current-password",classNames:{label:"text-black/50 dark:text-white/90",input:["bg-transparent","text-black/90 dark:text-white/90","placeholder:text-default-700/50 dark:placeholder:text-white/60"],innerWrapper:"bg-transparent",inputWrapper:["shadow-xl","bg-default-100/70","dark:bg-default/60","backdrop-blur-xl","backdrop-saturate-200","hover:bg-default-0/70","dark:hover:bg-default/70","group-data-[focus=true]:bg-default-100/50","dark:group-data-[focus=true]:bg-default/60","!cursor-text"]},isDisabled:o||u,label:"Token",placeholder:"è¯·è¾“å…¥token",radius:"lg",size:"lg",startContent:e.jsx(T,{className:"text-black/50 mb-0.5 dark:text-white/90 text-slate-400 pointer-events-none flex-shrink-0"}),value:c,onChange:t=>h(t.target.value),onClear:()=>h("")})]}),e.jsx("div",{className:"text-center text-small text-default-600 dark:text-default-400 px-2",children:"ğŸ’¡ æç¤ºï¼šè¯·ä» NapCat å¯åŠ¨æ—¥å¿—ä¸­æŸ¥çœ‹ç™»å½•å¯†é’¥"}),e.jsxs(I,{className:"mx-10 mt-10 text-lg py-7",color:"primary",isLoading:o,radius:"full",size:"lg",variant:"shadow",onPress:d,children:[!o&&e.jsx(j,{alt:"logo",classNames:{wrapper:"-ml-8"},height:"2em",src:C}),"ç™»å½•"]})]})]})})})]})}export{ne as default};
